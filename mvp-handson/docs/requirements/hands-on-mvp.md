# ハンズオン MVP 要件定義書

## 1. 前提条件

1. ここではわたしの「理解負債」を減らし、技術面での理解を深めた上でアプリ開発に入るための最小限の要件を定義する。
2. このハンズオン MVP アプリの開発では、あなた（AI）が行う実装は最小限にとどめること。
3. あなたがソースに触れて良いのは以下の場合に限定する。

   - 実装上の問題の指摘
   - こうした方が良いと思う実装の提案
   - 各関数・処理の解説コメント
   - そのほか細かな体裁の修正

4. あなたがソースに触れるのは、わたし（ネル）がレビューを依頼したときのみに限る。
5. あなたの役目は、わたしの「理解負債」を減らすための技術指南・教師役であることを明確に理解し、そのロールに徹底して従うこと。

---

## 2. ハンズオン MVP の目的とスコープ

### 2.1 目的

- TypeScript／React／Supabase／PostgreSQL／Tauri といった、本番開発で採用予定の技術スタックを **一通り経験し、仕組みを理解すること**。

- 「使えるレベルのメモ・タスク管理アプリ」を、

  - 自分で実装し、
  - 自分でビルドし、
  - まずはブラウザから利用できる Web アプリケーションとして完成させ、
  - その同一コードベースを用いて、デスクトップアプリとしても起動・利用できる状態にすること。

- 機能の多さだけでなく、**技術理解と「迷わず手を動かせる感覚」を得ること**を重視する。

- 本章および機能概要章に列挙された **すべての機能を、段階（フェーズ）を分けて最終的に実装し切ることをもって、「ハンズオン MVP 完了」と定義する。**

---

### 2.2 フェーズ構成（すべて本ハンズオン MVP のスコープ）

本ハンズオン MVP は、以下のフェーズに分けて実装する。
**Phase 0〜Phase 4 の全フェーズ完了が、本ハンズオン MVP の完了条件**となる。

各フェーズで定義された機能は、

- まず **Web ブラウザ上で動作する SPA（Vite + React + TypeScript）として実装・動作確認**を行い、
- その後、同一コードベースを **Tauri によるデスクトップアプリ**としてパッケージングし、同等の機能が動作することを確認する。

#### Phase 0: 基盤セットアップ

- 開発環境の構築

  - Node.js／npm／Git 等のセットアップ
  - （デスクトップフェーズ用として）Rust／Tauri CLI のセットアップ
  - Supabase プロジェクトの作成

- React + TypeScript + Vite による Web アプリ（SPA）のテンプレートプロジェクト作成
- Supabase（PostgreSQL）との接続確認

  - 単純なテーブルを用いた CRUD の動作確認

#### Phase 1: コア機能（単一テーブル CRUD + 3 カラム UI）

- メモとタスクを 1 つのエンティティとして扱う「単一テーブル」の CRUD を、Supabase 経由で実装
- PC 向けの 3 カラムレイアウト（タスク一覧／メモ一覧／詳細編集）の実装

  - 左カラム: タスク一覧＋作成
  - 中央カラム: メモ一覧＋作成
  - 右カラム: 選択中のメモ／タスクの詳細編集

- メモ／タスクの基本機能

  - メモの作成・編集（自動保存）・削除
  - タスクの作成（チェックボックス形式、一行入力）・編集・削除
  - タスクの完了設定（チェックボックス）

- 最低限のエラーハンドリングと入力バリデーション

#### Phase 2: メモ機能の拡張

機能概要「1. メモ機能」に列挙された以下の項目を、このフェーズで実装する。

- タイル・リスト表示切替可能
- 単一のテキストボックス入力欄
- 保存はテキストが入力された時点で自動保存・作成
- ファイルのアップロード

  - wav, mp4, html, java, blend, aep, cpr など幅広いファイル形式に対応

- メモの編集（自動保存）
- メモの削除
- メモのゴミ箱

  - 30 日間保持
  - ゴミ箱からの復元
  - ゴミ箱からの削除

- メモの検索

  - テキスト検索（タスク管理機能と統合された全体検索の一部として）

- markdown 形式の自動認識・プレビュー機能
- URL 貼り付け時の自動リンク化
- メモの並び替え・サイズ変更（自動保存）
- AI によるメモ要約・URL 要約

  - URL 要約は法に抵触しない範囲で実装
  - 機能イメージは https://craq.app を参考とする（実装方式は別途検討）

#### Phase 3: タスク管理機能の拡張

機能概要「2. タスク管理機能」に列挙された以下の項目を、このフェーズで実装する。

- 単一実行のタスク
- 周期的に実行するサイクルタスク
- タスクの作成（チェックボックス形式、一行入力）
- タスクの編集
- タスクの削除
- タスクの検索

  - メモ機能と統合された全体検索

- タスクの並び替え
- タスクのピン止め
- タスクの期限設定

  - 期限の進行度に応じた色分け

    - 緑: 0〜59%
    - 黄: 60〜89%
    - 赤: 90%以上

- タスクの完了設定
- 作成されたメモの紐づけ

  - タスクとメモとの多対多リンクとして設計（実装方式は別途 DB 設計で明示）

- タスクの通知

  - メール通知
  - プッシュ通知

#### Phase 4: UI・アカウント・設定・通知拡張

機能概要「3. UI イメージ」「4. アカウント・設定」に列挙された項目を、このフェーズで実装する。

- UI（PC）

  - 3 カラム構成

    - 左カラム: タスク管理表示
    - 中央カラム: メモ表示

- UI（モバイル）

  - 1 カラム構成
  - サイドメニューはハンバーガーメニュー
  - サイドメニューにタスク管理表示
  - 中央カラムはメモ表示

- アカウント・認証

  - アカウント新規作成
  - ログイン
  - ログアウト
  - Google アカウントでのログイン

- アカウント管理・設定

  - 退会
  - フィードバック送信
  - 通知設定

    - 通知先メールアドレス
    - 通知頻度
    - 通知時間
    - 通知するタスクの進捗閾値

  - 開発者支援（投げ銭）

---

### 2.3 ハンズオン MVP の完了条件（Definition of Done）

本ハンズオン MVP は、以下を **すべて満たした時点** をもって「完了」とみなす。

1. Phase 0〜Phase 4 に記載された機能が、**Web ブラウザ上のアプリケーション（SPA）として実装・動作確認済みであること。**
2. 上記 1 と同一コードベースを用いて、同じ機能セットを備えたアプリケーションが **Tauri アプリとしてビルドされていること**。

   - 少なくとも Windows 環境で
   - ローカル PC から起動し、
   - Supabase／PostgreSQL 上のデータと正常に連携していること。

3. メモ機能・タスク管理機能・UI・アカウント／設定機能について、
   機能概要章（「1. メモ機能」「2. タスク管理機能」「3. UI イメージ」「4. アカウント・設定」）に列挙された項目がすべて満たされていること。
4. 実装過程で得られた知見や躓きポイントを、ネル様自身が説明可能なレベルで理解していること
   （＝「理解負債」が許容範囲まで圧縮されていること）。

---

### 2.4 ランタイム別実装順序

- **Step 1: Web ブラウザ版（SPA）の完成**

  - React + TypeScript + Vite + Supabase を用いて、Phase 0〜Phase 4 の機能をすべてブラウザ上で実装・動作確認する。

- **Step 2: デスクトップ版（Tauri）のパッケージング**

  - Step 1 と同一のフロントエンドコードを用い、Tauri を導入して Windows 版／（必要に応じて）macOS 版・Linux 版のデスクトップアプリとしてビルド・動作確認する。

---

## 3. 技術スタック・アーキテクチャ方針

### 3.1 クライアント／アプリケーション層

- Web フロントエンド（ブラウザ SPA）:

  - 言語: TypeScript 5 系
  - UI フレームワーク: React 18
  - ビルドツール: Vite
  - 実行形態: シングルページアプリケーション（SPA）
  - 状態管理: React Hooks（useState / useEffect / useReducer 程度）、外部状態管理ライブラリ（Redux 等）は導入しない
  - スタイリング:

    - ハンズオン MVP では **素の CSS または CSS Modules** を採用し、UI フレームワーク（Tailwind, MUI 等）は使わない
    - 理由: 学習対象を TypeScript／Supabase／基本的な React パターンに集中させ、理解負債を増やさないため

- デスクトップラッパー（Tauri 版）:

  - Tauri v2 系
  - Rust（Tauri の標準テンプレートで生成される範囲にとどめる。独自コマンドは最小限、基本はフロントのみで完結させる）
  - 役割:

    - Web フェーズで完成した SPA のビルド成果物を組み込み、ネイティブ WebView 上で実行する
    - 必要に応じて、将来的に OS 機能（ネイティブ通知、ローカルファイルアクセス等）を露出する土台となる

### 3.2 データ層

- データベース:

  - Supabase が提供する PostgreSQL（マネージド）
  - 本ハンズオン MVP では 1 テーブル（`entries`）のみを使用

- アクセス方法:

  - `@supabase/supabase-js` を用いて、Web フロントエンド（React SPA）から直接 CRUD を行う
  - Tauri デスクトップ版でも同じクライアントコードを利用し、「フロント ↔ Supabase」の直結構成とする
  - Rust 側で独自のバックエンド API は挟まない（必要であれば将来フェーズで検討）

- セキュリティ／認可:

  - 本ハンズオン MVP は **ネル様個人利用前提** の環境とし、RLS や Auth は簡易に扱う
  - anon key をアプリ内に埋め込む構成とし、本番環境では「Supabase Auth + RLS を必須」とする前提を明記
  - 公開配布を前提とする場合は、この構成は暫定であり、後続フェーズで必ず見直す

### 3.3 実行対象プラットフォーム

- 最優先ターゲット（Web フェーズ）:

  - モダンブラウザ

    - Google Chrome
    - Microsoft Edge
    - Firefox
    - Safari など

- 第 2 ターゲット（デスクトップ フェーズ）:

  - Windows 10/11 (x64)

    - Tauri によりバイナリ（.exe 等）をビルド
    - ハンズオンではまずここで安定動作させることを最優先とする

  - macOS (Apple Silicon / Intel)

    - 余力があればビルド検証
    - macOS 向けバイナリのビルドには、Xcode + Command Line Tools を含む **macOS 実機または macOS Runner 環境**が必要となる（Windows だけで .app/.dmg を正しくビルドすることは基本的にできない）

  - Linux (x64)

    - 余力があればビルド検証

Tauri のクロスプラットフォーム性は活かしつつ、ハンズオンでは **まず Web ブラウザ上での動作を完成させ、その後 Windows デスクトップで安定して動かす** ことを優先する。

---

## 4. データモデル

### 4.1 テーブル構成（MVP）

ハンズオン MVP では「メモ」と「タスク」を同一テーブルで管理し、`kind` で区別する。

**テーブル名:** `entries`

```sql
create table public.entries (
  id         uuid primary key default gen_random_uuid(),
  kind       text not null check (kind in ('note', 'task')),
  title      text not null,
  body       text not null,
  is_done    boolean not null default false,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);
```

- `kind`:

  - `'note'` … メモ
  - `'task'` … タスク（一行タスク＋必要に応じて詳細を body に書く）

- `title`:

  - メモ／タスク共通のタイトル。タスクの場合は「タスク名」に相当。

- `body`:

  - メモ本文、またはタスクの詳細説明。

- `is_done`:

  - `kind = 'task'` の場合にのみ意味を持つ。
  - `kind = 'note'` の場合は常に `false` 想定とし、アプリ側で完了チェックは表示しない。

- `created_at` / `updated_at`:

  - Supabase 側で自動設定。
  - アプリ側はソートや表示に利用する。

### 4.2 TypeScript 型

```ts
export type EntryKind = "note" | "task";

export type Entry = {
  id: string;
  kind: EntryKind;
  title: string;
  body: string;
  isDone: boolean;
  createdAt: string; // ISO 8601 文字列
  updatedAt: string;
};
```

アプリ内部では `camelCase` を用い、DB との間でマッピングするシンプルなラッパを用意する（例: `mapDbEntryToEntry` / `mapEntryToDbPayload` など）。

---

## 5. ハンズオン MVP でまず実装するコア機能（Phase 1 中心）

### 5.1 メモ機能（Phase 1 コア）

Phase 1 では、メモ機能について以下のコア機能を実装対象とする。
（Phase 2 以降での拡張項目は 5.1.4 以降および 6.1 に整理する。）

1. **メモ一覧表示**

   - `kind = 'note'` のエントリのみを対象とする。
   - 並び順は `updated_at` 降順（更新が新しい順）を基本とする。
   - 一覧では「タイトル＋更新日時」を表示し、選択したメモの内容を右ペインに表示する。

2. **メモの作成**

   - 「新規メモ作成」ボタンを押すと、空のメモ（タイトル空／本文空）が作成される。
   - 作成時点で Supabase に `kind = 'note'` の行を INSERT する。
   - 新規作成後、詳細編集ペインにフォーカスを移す。

3. **メモの編集（自動保存）**

   - タイトル・本文とも、入力後に自動保存する。

   - 自動保存のトリガーは、以下のいずれかの簡易方式とする：

     - フォーカスアウト時（blur 時）に UPDATE
     - または、最後のキー入力から一定時間（例: 1 秒）経過したら UPDATE（単純な debounce 実装）

   - 保存が完了したら `updated_at` が更新され、一覧の並びも更新される。

4. **メモの削除**

   - メモ詳細画面に「削除」ボタンを配置する。
   - クリック時に確認ダイアログを表示し、OK 時に `DELETE` を実行する。
   - Phase 1 ではゴミ箱は実装せず、完全削除のみとする（ゴミ箱機能は Phase 2 で実装）。

5. **メモの簡易検索（任意）**

   - 余力があれば、タイトル・本文に対する単純な全文検索（`ilike '%keyword%'`）を実装する。
   - 検索対象は `kind = 'note'` のみ、または `kind` を問わない全体検索でもよい。

#### 5.1.x メモ機能の拡張項目（Phase 2 以降）

以下はメモ機能の拡張であり、Phase 2 以降で実装する。
ハンズオン MVP 全体としては必ず実装完了することを前提とする。

- タイル／リスト表示切替
- ファイルアップロード（あらゆる拡張子）
- ゴミ箱（30 日保持・復元・ゴミ箱からの削除）
- Markdown 自動認識・プレビュー
- URL 貼り付け時の自動リンク化
- メモの並び替え・サイズ変更（ドラッグ＆ドロップ等）
- AI によるメモ要約・URL 要約

---

### 5.2 タスク管理機能（Phase 1 コア）

Phase 1 では、タスク管理機能について以下のコア機能を実装対象とする。
（Phase 3 以降での拡張項目は 5.2.5 以降および 6.2 に整理する。）

1. **単一実行タスクの作成**

   - 左ペイン（タスクカラム）に、タスク一覧と入力欄を配置する。
   - 一行入力欄（テキスト＋追加ボタン）により、新規タスクを作成する。
   - 作成時のレコードは以下の値を持つ：

     - `kind = 'task'`
     - `title` = 入力された一行テキスト
     - `body` = 空文字（必要に応じ、詳細は後で編集可能）
     - `is_done = false`

2. **タスク一覧表示**

   - `kind = 'task'` のエントリのみ表示する。
   - 並び順は以下の簡易ルールとする：

     - 未完了 (`is_done = false`) を上に、完了 (`is_done = true`) を下に表示
     - 各グループ内は `created_at` 降順または `updated_at` 降順

3. **タスクの編集**

   - 一覧上でのインライン編集、または右ペインで詳細編集のどちらかに統一する。
   - Phase 1 では実装負荷を下げるため、**右ペインの詳細編集フォーム**（タイトル＋本文）に統一する。
   - メモ同様、自動保存（フォーカスアウト or 簡易 debounce）で UPDATE を行う。

4. **タスクの削除**

   - 一覧上、または詳細ペインに「削除」ボタンを設置し、確認ダイアログ後に DELETE を実行する。
   - Phase 1 ではゴミ箱機能は実装しない（完全削除）。

5. **タスクの完了設定**

   - 一覧上にチェックボックスを設置し、ON/OFF で `is_done` を更新する。
   - 完了タスクはスタイルを変える（取り消し線 or 薄い色など）。
   - チェックボックス操作直後に Supabase へ UPDATE する。

#### 5.2.x タスク機能の拡張項目（Phase 3 以降）

以下はタスク機能の拡張であり、Phase 3 以降で実装する。
ハンズオン MVP 全体としては必ず実装完了することを前提とする。

- 周期タスク（サイクルタスク）
- タスクのピン止め
- 任意の並び替え（ドラッグ＆ドロップ等）
- 期限設定と進捗による色変化（緑／黄／赤）
- メモとの高度な紐づけ（多対多リンク）
- メール／プッシュ通知

---

### 5.3 UI 構成（Phase 1 コア）

1. **PC 版レイアウト**

   - 基本は 3 カラム構成：

     - 左カラム: タスク一覧＋タスク作成
     - 中央カラム: メモ一覧＋メモ作成
     - 右カラム: 選択中のメモ／タスクの詳細編集（タイトル＋本文）

   - レイアウトは CSS のみで実装し、外部 UI フレームワークは利用しない。

2. **レスポンシブ対応（最小限）**

   - 画面幅が一定以下（例: 768px）になった場合、

     - カラムを縦に積む／2 カラムにする等の簡易対応をする。

   - Phase 1 では「スマホでも最低限読める程度」に留める。
     専用モバイル UI（ハンバーガーメニューや専用 1 カラム設計）は Phase 4 で実装する。

---

## 6. 機能リファレンス一覧（ハンズオン MVP 完了時の完全版）

この章では、ハンズオン MVP 全体で **最終的に実装されるべき完全版機能** の一覧を整理する。
各項目がどのフェーズで実装されるかは 2.2 のフェーズ構成および 5 章の説明を参照する。

### 6.1 メモ機能（完全版）

- タイル・リスト表示切替可能
- 単一のテキストボックス入力欄
- 保存はテキストが入力された時点で自動保存・作成
- ファイルのアップロード（wav, mp4, html, java, blend, aep, cpr など幅広いファイル形式に対応）
- メモの編集（自動保存）
- メモの削除
- メモのゴミ箱（30 日間保持）
- メモのゴミ箱からの復元
- メモのゴミ箱からの削除
- メモの検索（テキスト検索、タスク管理機能と統合された全体検索）
- Markdown 形式の自動認識・プレビュー機能
- URL 貼り付け時の自動リンク化
- メモの並び替え・サイズ変更（自動保存）
- AI によるメモ要約・張り付けられた URL 先の内容の要約（URL 要約は法に抵触しない範囲、機能イメージは [https://craq.app](https://craq.app) を参考）

### 6.2 タスク管理機能（完全版）

- 単一実行のタスク
- 周期的に実行するサイクルタスク
- タスクの作成（チェックボックス形式、一行入力）
- タスクの編集
- タスクの削除
- タスクの検索（メモ機能と統合された全体検索）
- タスクの並び替え
- タスクのピン止め
- タスクの期限設定（期限の進行によって緑(0~59%)→ 黄(60~89%)→ 赤(90%以上)で変化）
- タスクの完了設定
- 作成されたメモの紐づけ
- タスクの通知（メール、プッシュ通知）

### 6.3 UI イメージ（完全版）

- PC

  - 3 カラム構成
  - 左カラムはタスク管理表示
  - 中央カラムはメモ表示

- モバイル

  - 1 カラム構成
  - サイドメニューはハンバーガーメニュー
  - サイドメニューにタスク管理表示
  - 中央カラムはメモ表示

### 6.4 アカウント・設定（完全版）

- アカウント新規作成
- ログイン
- ログアウト
- Google アカウントでのログイン
- 退会
- フィードバック
- 通知設定（通知先メールアドレス、通知頻度、通知時間、通知するタスクの進捗閾値）
- 開発者支援（投げ銭）

---

## 7. 開発プロセスとロール分担

### 7.1 ロール

- ネル様:

  - 実装の主体
  - 設計・仕様の最終決定者
  - コードの作成・修正・動作確認を行う

- AI（本アシスタント）:

  - 技術指南・教師役・レビュー担当
  - ソースコードの直接編集は、ネル様からの明示的なレビュー依頼時に限定し、

    - 問題指摘
    - 改善提案
    - 解説コメント
    - 体裁修正

    にとどめる（ロジック丸ごと書き換えなどは原則しない）

### 7.2 推奨開発ステップ（Web → Desktop）

**Web フェーズ（ブラウザ版）**

1. 開発環境準備（Web）

   - Node.js, npm, Git のセットアップ
   - エディタ／IDE（VS Code 等）の準備

2. Web プロジェクト雛形の作成

   - `npm create vite@latest` などを用いて、React + TypeScript + Vite プロジェクトを作成
   - ローカルで `npm run dev` によりブラウザ上での起動を確認

3. Supabase プロジェクト作成

   - Supabase のコンソールから新規プロジェクトを作成
   - `entries` テーブルの作成（本書 4 章の定義に従う）

4. Supabase クライアント実装（Web）

   - `supabaseClient.ts` の作成
   - `entries` の CRUD を行う関数群の作成
   - ブラウザコンソールでの簡易動作確認（一覧取得／1 件追加など）

5. UI 実装（Phase 1 コア）

   - タスクカラム／メモカラム／詳細カラムの 3 カラムレイアウトを実装
   - メモ・タスクの作成／編集／削除／完了を実装
   - 最低限のバリデーションとエラーハンドリングを実装

6. Web 版の動作確認とビルド

   - 手動テストシナリオの作成・実行
   - `npm run build` による本番ビルドを行い、build 成果物での起動確認（ローカルサーバー等）

7. Phase 2〜4 の Web 実装

   - メモ機能拡張（ファイルアップロード、Markdown、AI 要約など）
   - タスク拡張（サイクルタスク、期限、通知など）
   - UI 拡張、アカウント・設定機能の実装
   - それぞれのフェーズで Web 版の動作確認を完了させる

**デスクトップ フェーズ（Tauri 版）**

8. 開発環境準備（Desktop）

   - Rust, Cargo, Tauri CLI のセットアップ
   - Windows でのビルドに必要なビルドツール（例: Visual Studio Build Tools）の導入
   - macOS 版を狙う場合は macOS 上で Xcode + Command Line Tools を準備

9. 既存 Web プロジェクトへの Tauri 導入

   - 既存の Vite + React + TS プロジェクトに対し、Tauri の初期化コマンドを実行して `src-tauri/` を追加
   - Tauri 設定ファイル（`tauri.conf.json` 等）でビルド設定を調整

10. Tauri 開発モードでの動作確認

    - `npm run tauri dev` によってデスクトップアプリとして起動し、Web 版と同等の操作が行えることを確認

11. デスクトップ版のビルドと自己利用リリース

    - `npm run tauri build` によるバイナリ生成
    - Windows（および余力があれば macOS／Linux）で生成物を起動し、Web 版と同等の機能が正常に動作することを確認

12. 振り返りと理解整理

    - 各ステップで得た知見・躓きポイントをメモとして残し、今後の本番開発の「理解負債」を減らす

---

## 8. コーディングルール原則

本プロジェクト（ハンズオン MVP および将来の本番版）では、以下のコーディング原則を順守する。

1. **DRY 原則（Don't Repeat Yourself）**
   同じコードやロジックを繰り返さず、再利用可能な形で設計する。

2. **KISS 原則（Keep It Simple, Stupid）**
   コードや設計は可能な限りシンプルで直感的に理解できるものにする。

3. **YAGNI（You Aren't Gonna Need It）**
   必要になるまで機能を実装しないことで、無駄な労力を省く。

4. **SOLID**
   オブジェクト指向設計を支える 5 つの原則（単一責任、開放/閉鎖、リスコフの置換、インターフェース分離、依存性逆転）を指す。

5. **デメテルの法則（Law of Demeter）**
   オブジェクトは直接関連のあるものだけを操作し、間接的な依存を避ける。

6. **GRASP（General Responsibility Assignment Software Patterns）**
   責務の分担や設計を体系化する指針で、低結合や高凝集などの原則を含む。
